---
import { Link } from '@components/ui/link'
import { Button } from '@/components/ui/button'
import { getRelativeLocaleUrl } from 'astro:i18n'
import { Menu, X } from 'lucide-react'
import ThemeToggle from './ThemeToggle.astro'
import LanguageSwitcher from './LanguageSwitcher.astro'
import { useTranslations, defaultLocale, type Language } from '@i18n/utils'
const { lang } = Astro.params
const currentLocale = lang ?? defaultLocale
const t = useTranslations(lang as Language)

// Navigation links
const navLinks = [
  { href: '/', label: t('nav.home') },
  { href: '/about', label: t('nav.about') },
  { href: '/projects', label: t('nav.projects') },
  { href: '/experience', label: t('nav.experience') },
  { href: '/skills', label: t('nav.skills') },
  { href: '/education', label: t('nav.education') },
  { href: '/blog', label: t('nav.blog') },
  { href: '/contact', label: t('nav.contact') },
]
---

<header
  class="bg-background/95 supports-[backdrop-filter]:bg-background/60 sticky top-0 z-50 w-full border-b backdrop-blur"
>
  <div class="container flex h-16 items-center justify-between">
    <div class="flex items-center gap-2">
      <a href={getRelativeLocaleUrl(currentLocale, '/')} class="text-xl font-bold tracking-tight">
        {t('name')}
      </a>
    </div>

    <!-- Desktop Navigation -->
    <nav class="hidden items-center gap-6 md:flex">
      {
        navLinks.map((link) => (
          <a
            href={getRelativeLocaleUrl(currentLocale, link.href)}
            class="hover:text-primary text-sm font-medium"
          >
            {link.label}
          </a>
        ))
      }
    </nav>
    <div class="flex items-center gap-2">
      <LanguageSwitcher />
      <ThemeToggle />
      <Link
        href={getRelativeLocaleUrl(currentLocale, '/contact')}
        className="hidden md:inline-flex"
      >
        {t('button.contact')}
      </Link>
      <Button variant="outline" size="icon" id="menu-toggle" className="md:hidden">
        <X className="menu-icon hidden h-5 w-5" />
        <Menu className="close-icon h-5 w-5" />
      </Button>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <div id="mobile-menu" class="hidden border-t md:hidden">
    <div class="container flex flex-col space-y-4 py-4">
      {
        navLinks.map((link) => (
          <a href={getRelativeLocaleUrl(currentLocale, link.href)} class="py-2 text-sm font-medium">
            {link.label}
          </a>
        ))
      }
      <a
        href={getRelativeLocaleUrl(currentLocale, '/contact')}
        class="bg-primary text-primary-foreground hover:bg-primary/90 inline-flex h-10 w-full items-center justify-center rounded-md px-4 text-sm font-medium transition-colors"
      >
        {t('button.contact')}
      </a>
    </div>
  </div>
</header>

<script>
  console.log('Header script loaded')
  document.addEventListener('astro:page-load', () => {
    const menuToggle = document.getElementById('menu-toggle')
    const mobileMenu = document.getElementById('mobile-menu')
    const menuIcon = document.querySelector('.menu-icon')
    const closeIcon = document.querySelector('.close-icon')
    console.log(menuToggle, mobileMenu, menuIcon, closeIcon)
    if (menuToggle && mobileMenu && menuIcon && closeIcon) {
      menuToggle.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden')
        menuIcon.classList.toggle('hidden')
        closeIcon.classList.toggle('hidden')
      })

      // Also close menu when clicking on mobile navigation links
      const mobileLinks = mobileMenu.querySelectorAll('a')
      mobileLinks.forEach((link) => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden')
          menuIcon.classList.remove('hidden')
          closeIcon.classList.add('hidden')
        })
      })
    }
  })
</script>
